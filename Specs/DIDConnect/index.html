
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.0">
    
    
      
        <title>OpenID Connect Profile for self-sovereign identity (DIDConnect) - KayTrust Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bc7e593a.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab28b872.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openid-connect-profile-for-self-sovereign-identity-didconnect" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="KayTrust Developer Documentation" class="md-header-nav__button md-logo" aria-label="KayTrust Developer Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.59 3.41L2 8l4.59 4.6L8 11.18 4.82 8 8 4.82 6.59 3.41m5.82 0L11 4.82 14.18 8 11 11.18l1.41 1.42L17 8l-4.59-4.59m9.18 8.18l-8.09 8.09L9.83 16l-1.41 1.41 5.08 5.09L23 13l-1.41-1.41z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            KayTrust Developer Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              OpenID Connect Profile for self-sovereign identity (DIDConnect)
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KayTrust Developer Documentation" class="md-nav__button md-logo" aria-label="KayTrust Developer Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.59 3.41L2 8l4.59 4.6L8 11.18 4.82 8 8 4.82 6.59 3.41m5.82 0L11 4.82 14.18 8 11 11.18l1.41 1.42L17 8l-4.59-4.59m9.18 8.18l-8.09 8.09L9.83 16l-1.41 1.41 5.08 5.09L23 13l-1.41-1.41z"/></svg>

    </a>
    KayTrust Developer Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" class="md-nav__link">
      Specs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Manuals/" class="md-nav__link">
      Manuals
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Tutorials/" class="md-nav__link">
      Tutorials
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-flow" class="md-nav__link">
    General flow
  </a>
  
    <nav class="md-nav" aria-label="General flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-client-registration" class="md-nav__link">
    1. Client registration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-authentication-request" class="md-nav__link">
    2. Authentication request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-obtaining-user-consent-from-as" class="md-nav__link">
    3. Obtaining user consent from AS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-token-generation" class="md-nav__link">
    4. Token generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-getting-the-tokens-andor-authorization-code" class="md-nav__link">
    5. Getting the tokens and/or authorization code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-accessing-the-tokens-if-applicable" class="md-nav__link">
    6. Accessing the tokens (if applicable)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-verification-of-users-identity" class="md-nav__link">
    7. Verification of user's identity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-accessing-the-users-protected-resources-when-applicable" class="md-nav__link">
    8. Accessing the user's protected resources (when applicable)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registration-of-custom-scheme-by-authorization-server-applications" class="md-nav__link">
    Registration of custom scheme by Authorization Server applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#current-limitations" class="md-nav__link">
    Current limitations
  </a>
  
    <nav class="md-nav" aria-label="Current limitations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-flow-support" class="md-nav__link">
    Variable flow support
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="openid-connect-profile-for-self-sovereign-identity-didconnect">OpenID Connect Profile for self-sovereign identity (DIDConnect)</h1>
<h2 id="introduction">Introduction</h2>
<p>This document describes a method, nicknamed "DID Connect", to authenticate a user against their <a href="https://www.w3.org/TR/did-core/">Decentralized Identifier (DID)</a>. This method uses <a href="https://openid.net/developers/specs/">OpenID Connect (OIDC)</a>, which itself builds upon the <a href="https://tools.ietf.org/html/rfc6749">OAuth 2.0 framework</a>.</p>
<p>The objective of DID Connect is to extend OIDC in a way that makes it as resource-owner-centric as possible, to enable Self-Sovereign Identity (SSI) scenarios. That decentralization makes DID Connect different from traditional provider-centric OIDC flows in a few aspects, as detailed below.</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Provider-Centric Identity</th>
<th>Self-Sovereign Identity</th>
</tr>
</thead>
<tbody>
<tr>
<td>Subject ID (<code>sub</code>)</td>
<td>IdP-assigned.</td>
<td>User's DID.</td>
</tr>
<tr>
<td>Client registration flow</td>
<td>Client registers against IdP (must be authorized by IdP).</td>
<td>No authorization needed by a central entity for acting as a client. Authorization is whatever set of Verifiable Credentials the client is able to present.</td>
</tr>
<tr>
<td>Client information</td>
<td>Held and shown by IdP.</td>
<td>Verifiable Presentation, containing Verifiable Credentials issued by any relevant authorities.</td>
</tr>
<tr>
<td>Client ID</td>
<td>IdP-assigned.</td>
<td>URL of the Verifiable Presentation.</td>
</tr>
<tr>
<td>Authorization Server</td>
<td>Identity Provider (IdP), known by the Relying Party before creating the request.</td>
<td>Chosen by user during authentication. Examples: user's own identity wallet, or a web application.</td>
</tr>
<tr>
<td>Authorization endpoint</td>
<td>Contains the Identity Provider (IdP)'s hostname. Either static or discovered through OIDC Discovery.</td>
<td>Custom scheme (<code>didconnect:</code>).</td>
</tr>
<tr>
<td>Token endpoint (when applicable)</td>
<td>Contains the Identity Provider (IdP)'s hostname. Either static or discovered through OIDC Discovery.</td>
<td>Provided as <code>token_uri</code> parameter in the authorization response. (<strong>WIP</strong>.)</td>
</tr>
<tr>
<td>Userinfo endpoint</td>
<td>Managed by IdP. Either static or discovered through OIDC Discovery.</td>
<td>Contained in <code>id_token</code> (<code>userinfo</code> claim).</td>
</tr>
<tr>
<td>Public key for id_token's signature by client</td>
<td>Either static or discovered through OIDC Discovery.</td>
<td>Listed in DID Document (DDO).</td>
</tr>
<tr>
<td>Client's whitelisted redirect_uri endpoints</td>
<td>Registered and checked by the IdP.</td>
<td>Announced as a claim in the Client ID's Verifiable Presentation.</td>
</tr>
<tr>
<td>Supported flows</td>
<td>Either static or discovered through OIDC Discovery.</td>
<td>Negotiated during authentication (<strong>WIP</strong>).</td>
</tr>
</tbody>
</table>
<h2 id="general-flow">General flow</h2>
<p>The OIDC specification defines the following general flow:</p>
<ol>
<li>Client registers (once).</li>
<li>Client presents an authentication request in the form of a <code>didconnect://auth?...</code> URI.</li>
<li>Authorization Server (AS) authenticates the Resource Owner (for example, if the AS is a mobile app, the user should unlock the app) and asks for consent.</li>
<li>Depending on the value of <code>response_type</code>, AS generates a combination of identity token, grant code, and/or access token, then provides them to the client's <code>redirect_uri</code> contained in the request, following the <code>response_mode</code> parameter (form, post or fragment).</li>
<li>The client receives the tokens and/or code.</li>
<li><em>Authorization flow only.</em> Client gets the URL of the token endpoint and uses it to request the <code>id_token</code> and/or <code>access_token</code>.</li>
<li>Client checks the signature of <code>id_token</code> as a JWT and reads user's identity from the token.</li>
<li>If a <code>userinfo</code> claim is available in <code>id_token</code> and an <code>access_token</code> was provided, client queries that endpoint, using the access token for authentication.</li>
</ol>
<p>Specificities on how those steps are to be applied for DIDConnect are detailed in the following sections.</p>
<h3 id="1-client-registration">1. Client registration</h3>
<ol>
<li>Relying Party obtains a DID.</li>
<li>RP obtains Verifiable Credentials whose subject is the RP's DID, and issued by entities trusted by the targeted users. How users should trust the RP's DID and/or credentials is outside the scope of this specification. The credentials should typically claim information about the RP, such as the application's name, originating organization, logo, website, etc, but the semantics of such claims is also outside the scope of this specification.</li>
<li>RP obtains a Verifiable Credential whose subject is the RP's DID, and containing the claim <code>redirect_uri</code> with the value of whitelisted callback URL(s). Like the previous point, how the AS should trust that credential is not defined in this document. However, it is recommended that the credential is self-issued, i.e. the issuer is also the RP's DID.</li>
<li>RP creates a Verifiable Presentation containing those credentials, and whose holder is the RP's DID.</li>
<li>The Verifiable Presentation is available at a location where users will be able to access it. The RP's Client ID is the presentation's URL.</li>
</ol>
<h3 id="2-authentication-request">2. Authentication request</h3>
<p>An authentication request is a URL of the following form: <code>didconnect://auth?...</code> with the same query parameters as defined in the OIDC specification. The value of <code>client_id</code> is the one obtained during registration.</p>
<h3 id="3-obtaining-user-consent-from-as">3. Obtaining user consent from AS</h3>
<p>When a user's Authorization Server receives a request from the application's client_id, it must treat <code>client_id</code> as an URL and fetch the Verifiable Presentation (VP) from it. Then, the AS must check the following conditions:</p>
<ul>
<li>The VP's proof is valid.</li>
<li>The VP is within validity date.</li>
<li>The <code>redirect_uri</code> value from the authentication request matches one of the values present in the VP's <em>valid credentials</em>.</li>
</ul>
<p>Then, the AS should ask for user's consent after displaying all relevant claims, based on <em>valid credentials</em>.</p>
<p>Note: For <code>redirect_uri</code> and displayed claims, <strong><em>valid credentials</em></strong> are credentials with a valid proof, that are within validity dates, and whose subject ID is the same as the VP's holder.</p>
<h3 id="4-token-generation">4. Token generation</h3>
<p>See OpenID Connect specification.</p>
<h3 id="5-getting-the-tokens-andor-authorization-code">5. Getting the tokens and/or authorization code</h3>
<p>See OpenID Connect specification.</p>
<h3 id="6-accessing-the-tokens-if-applicable">6. Accessing the tokens (if applicable)</h3>
<p>See OpenID Connect specification. Token endpoint URI is taken from the <code>token_uri</code> parameter contained in the response.</p>
<h3 id="7-verification-of-users-identity">7. Verification of user's identity</h3>
<p>The RP's endpoint listening on <code>redirect_uri</code> receives the same data as defined in OIDC specification.</p>
<p>The JWT contained in the <code>id_token</code> is the same as defined in the OIDC specification, with the following differences:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Meaning in DID Connect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sub</code></td>
<td>The user's DID.</td>
</tr>
<tr>
<td><code>iss</code></td>
<td>The identifier (resolved from the DID Document) of the public key that is signing the JWT. The key must be valid for that DID and the JWT must be signed by that key.</td>
</tr>
<tr>
<td><code>aud</code></td>
<td>The requester's DID. It must match the value of <code>client_id</code> in the request.</td>
</tr>
<tr>
<td><code>userinfo</code></td>
<td>The URL of the Resource Server where a user's Verifiable Presentation is available.</td>
</tr>
</tbody>
</table>
<p>The Relying Party must verify that:</p>
<ul>
<li>The key identified in <code>iss</code> is an authorized key of the DID value in <code>sub</code>, by looking at the DID Document.</li>
<li>The JWT is signed by that key.</li>
</ul>
<h3 id="8-accessing-the-users-protected-resources-when-applicable">8. Accessing the user's protected resources (when applicable)</h3>
<p>If an access token was provided, the client can access user's information by querying the URL referenced as <code>userinfo</code> in the id_token, and provide the access token as an <code>Authorization</code> header, as described in <a href="https://openid.net/specs/openid-connect-core-1_0.html#UserInfoRequest">OpenID Connect specification</a>.</p>
<p>The response is a Verifiable Presentation. The presentation must be valid (proof-wise), within validity dates, and the presentation's holder must be the user's authenticated DID.</p>
<h2 id="registration-of-custom-scheme-by-authorization-server-applications">Registration of custom scheme by Authorization Server applications</h2>
<p>This specification describes the use of a custom URI scheme to express authorization requests, very much like the use of <code>mailto:</code> or <code>tel:</code> URI schemes. This makes it possible for any registered application on the user agent to handle requests after registering itself for the <code>didconnect:</code> custom scheme on the RO's operating system.</p>
<p>Below are examples of Authorization Servers.</p>
<table>
<thead>
<tr>
<th>AS implementation</th>
<th>Custom scheme registration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mobile or desktop application</td>
<td>Specific to the operating system</td>
</tr>
<tr>
<td>Web application</td>
<td>Using <code>registerProtocolHandler()</code> on the web browser</td>
</tr>
</tbody>
</table>
<h2 id="current-limitations">Current limitations</h2>
<h3 id="variable-flow-support">Variable flow support</h3>
<p>Some authorization servers, especially native implementations (either mobile or desktop), are usually not exposed to the public internet and thus can't easily provide a token endpoint, which means they will have limited or no support for <code>code</code> response types.</p>
<p>This possibility represents both a risk of failure and added out-of-band work on the client side to try and guess what flow to request. One approach is to determine the type of AS based on heuristics, but work must still be done to propose a good workaround to this limitation.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.6a3d08fc.min.js"></script>
      <script src="../../assets/javascripts/bundle.71201edf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['navigation.instant'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>