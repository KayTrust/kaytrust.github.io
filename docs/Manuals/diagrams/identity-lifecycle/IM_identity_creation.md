# Adding another device

Assumptions:

* In order to show how to interact with the IdentityManager contract assume an already deployed instance of that and lets call it AcmeIdentityManager. Now thorugh this contract many users can deploy their identities.

## Flow

Following the guide, lets assume John wants to add another device from which he can control its identity operations. Adding such device is as simple as giving it the desired capability(forward, device manager, admin or proxy). The next diagram shows what is the flow to achieve that:

[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZUEtPj4rSWRlbnRpdHlNYW5hZ2VyL3NldENhcDogbXlQcm94eUFkZGRyZXNzLDxici8-Sm9obkRldmljZUJBZGRyZXNzLDxici8-Y2FwYWJpbGl0eSw8YnIvPnRpbWVcblx0YWx0IGhhcyBKaG9uRGV2aWNlQSBcImRldmljZU1hbmFnZXJcIiBjYXBhYmlsaXR5P1xuXHRJZGVudGl0eU1hbmFnZXIvc2V0Q2FwLT4-SWRlbnRpdHlNYW5hZ2VyL3NldENhcDogQWRkcyBkZXNpcmVkIGNhcGFiaWxpdHk8YnIvPmZvciBKb2huJ3MgZGV2aWNlIEIgYW5kIGZvciB0aGUgPGJyPnNwZWNpZmllZCB0aW1lXG5cdElkZW50aXR5TWFuYWdlci9zZXRDYXAtLT4-Sm9obkRldmljZUE6IEFkZGVkIENhcGFiaWxpdHkgKGV2ZW50KVxuXHRlbHNlIG5vdCBhdXRob3JpemVkXG5cdElkZW50aXR5TWFuYWdlci9zZXRDYXAtLT4-Sm9obkRldmljZUE6IFRocm93XG5cdGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZUEtPj4rSWRlbnRpdHlNYW5hZ2VyL3NldENhcDogbXlQcm94eUFkZGRyZXNzLDxici8-Sm9obkRldmljZUJBZGRyZXNzLDxici8-Y2FwYWJpbGl0eSw8YnIvPnRpbWVcblx0YWx0IGhhcyBKaG9uRGV2aWNlQSBcImRldmljZU1hbmFnZXJcIiBjYXBhYmlsaXR5P1xuXHRJZGVudGl0eU1hbmFnZXIvc2V0Q2FwLT4-SWRlbnRpdHlNYW5hZ2VyL3NldENhcDogQWRkcyBkZXNpcmVkIGNhcGFiaWxpdHk8YnIvPmZvciBKb2huJ3MgZGV2aWNlIEIgYW5kIGZvciB0aGUgPGJyPnNwZWNpZmllZCB0aW1lXG5cdElkZW50aXR5TWFuYWdlci9zZXRDYXAtLT4-Sm9obkRldmljZUE6IEFkZGVkIENhcGFiaWxpdHkgKGV2ZW50KVxuXHRlbHNlIG5vdCBhdXRob3JpemVkXG5cdElkZW50aXR5TWFuYWdlci9zZXRDYXAtLT4-Sm9obkRldmljZUE6IFRocm93XG5cdGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)

As shown in the prevous diagram, a new device has been added on behalf of John.

* Only "deviceManager" granted roles can authorize other devices.

* Because "device B" has "deviveManager" capability then **it can grant any authorization level** on behalf of John.

* **Removing a device** is similar to the adding process. The difference lies in the argument time, that is set a time less than the current time. For more information please check the setCap method in the IdentityManager contract.

### Recover your identity

Lets imagine the situation where you no longer can access your device(s). In such scenario you can still recover your identity. 
In order to perform this process you can set a trusted third party with an "devicemanager" capability. In case of disaster scenarios you can contact the third party that after an offline check process can help you set a new device which can help you access your already blockchain existing identity.

### Migrating to a new IdentityManager

Lets imagine the situation when users want to migrate to a new IdentityManager, such scenario is totally feasible. In order to exemplify this, assume John as an identity that was created using Acme Identity Manager contract but something happened and he decides to migrate to a new Identity Manager contract lets name this CorpIM. The following diagram shows the logical flow when a new IdentityManager replaces an old one.

[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZUEtPj5BY21lSU0vdXBncmFkZTogcmVnaXN0ZXI8YnIvPkNvcnBJTVxuXHRhbHQgaGFzIEpvaG5EZXZpY2VBIEFkbWluIENhcGFiaWxpdHk_XG5cdEFjbWVJTS91cGdyYWRlLT4-Sm9oblByb3h5L2FkZE93bmVyOiBhZGQgQ29ycElNXG5cdGFsdCBpcyBBY21lSU0gT3duZXIgb2YgSmhvbiBQcm94eT9cblx0XHRKb2huUHJveHkvYWRkT3duZXItPj5Kb2huUHJveHkvYWRkT3duZXI6IEFkZDxici8-IENvcnBJTTxici8-YXMgbmV3IG93bmVyXG5cdFx0Sm9oblByb3h5L2FkZE93bmVyLS0-PkFjbWVJTS91cGdyYWRlOiBjb250aW51ZVxuXHRcblx0XG5cdEFjbWVJTS91cGdyYWRlLT4-Sm9oblByb3h5L3Jlbm91bmNlOiByZW1vdmUgb2xkIEFjbWVJTVxuXHRhbHQgaXMgQWNtZUlNIE93bmVyIG9mIEpvaG5Qcm94eVx0XHRcblx0XHRKb2huUHJveHkvcmVub3VuY2UtPj5Kb2huUHJveHkvcmVub3VuY2U6IFJlbW92ZTxici8-IE9sZCBBY21lSU1cblx0XHRKb2huUHJveHkvcmVub3VuY2UtLT4-QWNtZUlNL3VwZ3JhZGU6IGNvbnRpbnVlXG5cdFxuXG5cdEFjbWVJTS91cGdyYWRlLT4-Q29ycElNL3JlZ2lzdGVySWRlbnRpdHk6IHJlZ2lzdGVyIGV4aXN0aW5nIHByb3h5IHRvIHRoZSBuZXcgQWNtZUlNXG5cdENvcnBJTS9yZWdpc3RlcklkZW50aXR5LT4-Q29ycElNL3JlZ2lzdGVySWRlbnRpdHk6IGNoZWNrIEpvaG5Qcm94eTxici8-IGlzIG5vdCByZWdpc3RlcmVkXG5cdENvcnBJTS9yZWdpc3RlcklkZW50aXR5LT4-Q29ycElNL3JlZ2lzdGVySWRlbnRpdHk6IHJlZ2lzdGVyIEpvaG5Qcm94eVxuXHRDb3JwSU0vcmVnaXN0ZXJJZGVudGl0eS0-PkNvcnBJTS9yZWdpc3RlcklkZW50aXR5OiB2ZXJpZnkgQ29ycElNPGJyLz4gb3ducyBKb2huUHJveHlcblx0Q29ycElNL3JlZ2lzdGVySWRlbnRpdHktPj5Db3JwSU0vcmVnaXN0ZXJJZGVudGl0eTogc2V0IEpvaG5EZXZpY2VBIHdpdGggYWxsPGJyLz4gY2FwYWJpbGl0aWVzXG5cdENvcnBJTS9yZWdpc3RlcklkZW50aXR5LS0-PkpvaG5EZXZpY2VBOiBJZGVudGl0eSByZWdpc3RlcmVkIChldmVudClcblx0Q29ycElNL3JlZ2lzdGVySWRlbnRpdHktLT4-QWNtZUlNL3VwZ3JhZGU6IG9rXG5cdEFjbWVJTS91cGdyYWRlLT4-QWNtZUlNL3VwZ3JhZGU6IHVucmVnaXN0ZXIgSm9oblByb3h5XG5cdEFjbWVJTS91cGdyYWRlLS0-PkpvaG5EZXZpY2VBOiBJZGVudGl0eSB1cGdyYWRlZCAoZXZlbnQpXG5cblx0ZWxzZSBvdGhlcndpc2Vcblx0XHRKb2huUHJveHkvcmVub3VuY2UtLT4-Sm9obkRldmljZUE6IFRocm93XG5cdGVuZFxuXG5cdGVsc2Ugb3RoZXJ3aXNlXG5cdFx0Sm9oblByb3h5L2FkZE93bmVyLS0-PkpvaG5EZXZpY2VBOiBUaHJvd1xuXHRlbmRcblxuXHRlbHNlIG90aGVyd2lzZVxuXHRcdEFjbWVJTS91cGdyYWRlLS0-PkpvaG5EZXZpY2VBOiBUaHJvd1xuXHRlbmQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZUEtPj5BY21lSU0vdXBncmFkZTogcmVnaXN0ZXI8YnIvPkNvcnBJTVxuXHRhbHQgaGFzIEpvaG5EZXZpY2VBIEFkbWluIENhcGFiaWxpdHk_XG5cdEFjbWVJTS91cGdyYWRlLT4-Sm9oblByb3h5L2FkZE93bmVyOiBhZGQgQ29ycElNXG5cdGFsdCBpcyBBY21lSU0gT3duZXIgb2YgSmhvbiBQcm94eT9cblx0XHRKb2huUHJveHkvYWRkT3duZXItPj5Kb2huUHJveHkvYWRkT3duZXI6IEFkZDxici8-IENvcnBJTTxici8-YXMgbmV3IG93bmVyXG5cdFx0Sm9oblByb3h5L2FkZE93bmVyLS0-PkFjbWVJTS91cGdyYWRlOiBjb250aW51ZVxuXHRcblx0XG5cdEFjbWVJTS91cGdyYWRlLT4-Sm9oblByb3h5L3Jlbm91bmNlOiByZW1vdmUgb2xkIEFjbWVJTVxuXHRhbHQgaXMgQWNtZUlNIE93bmVyIG9mIEpvaG5Qcm94eVx0XHRcblx0XHRKb2huUHJveHkvcmVub3VuY2UtPj5Kb2huUHJveHkvcmVub3VuY2U6IFJlbW92ZTxici8-IE9sZCBBY21lSU1cblx0XHRKb2huUHJveHkvcmVub3VuY2UtLT4-QWNtZUlNL3VwZ3JhZGU6IGNvbnRpbnVlXG5cdFxuXG5cdEFjbWVJTS91cGdyYWRlLT4-Q29ycElNL3JlZ2lzdGVySWRlbnRpdHk6IHJlZ2lzdGVyIGV4aXN0aW5nIHByb3h5IHRvIHRoZSBuZXcgQWNtZUlNXG5cdENvcnBJTS9yZWdpc3RlcklkZW50aXR5LT4-Q29ycElNL3JlZ2lzdGVySWRlbnRpdHk6IGNoZWNrIEpvaG5Qcm94eTxici8-IGlzIG5vdCByZWdpc3RlcmVkXG5cdENvcnBJTS9yZWdpc3RlcklkZW50aXR5LT4-Q29ycElNL3JlZ2lzdGVySWRlbnRpdHk6IHJlZ2lzdGVyIEpvaG5Qcm94eVxuXHRDb3JwSU0vcmVnaXN0ZXJJZGVudGl0eS0-PkNvcnBJTS9yZWdpc3RlcklkZW50aXR5OiB2ZXJpZnkgQ29ycElNPGJyLz4gb3ducyBKb2huUHJveHlcblx0Q29ycElNL3JlZ2lzdGVySWRlbnRpdHktPj5Db3JwSU0vcmVnaXN0ZXJJZGVudGl0eTogc2V0IEpvaG5EZXZpY2VBIHdpdGggYWxsPGJyLz4gY2FwYWJpbGl0aWVzXG5cdENvcnBJTS9yZWdpc3RlcklkZW50aXR5LS0-PkpvaG5EZXZpY2VBOiBJZGVudGl0eSByZWdpc3RlcmVkIChldmVudClcblx0Q29ycElNL3JlZ2lzdGVySWRlbnRpdHktLT4-QWNtZUlNL3VwZ3JhZGU6IG9rXG5cdEFjbWVJTS91cGdyYWRlLT4-QWNtZUlNL3VwZ3JhZGU6IHVucmVnaXN0ZXIgSm9oblByb3h5XG5cdEFjbWVJTS91cGdyYWRlLS0-PkpvaG5EZXZpY2VBOiBJZGVudGl0eSB1cGdyYWRlZCAoZXZlbnQpXG5cblx0ZWxzZSBvdGhlcndpc2Vcblx0XHRKb2huUHJveHkvcmVub3VuY2UtLT4-Sm9obkRldmljZUE6IFRocm93XG5cdGVuZFxuXG5cdGVsc2Ugb3RoZXJ3aXNlXG5cdFx0Sm9oblByb3h5L2FkZE93bmVyLS0-PkpvaG5EZXZpY2VBOiBUaHJvd1xuXHRlbmRcblxuXHRlbHNlIG90aGVyd2lzZVxuXHRcdEFjbWVJTS91cGdyYWRlLS0-PkpvaG5EZXZpY2VBOiBUaHJvd1xuXHRlbmQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)

As shown in the prevous diagram, a new IdentityManager (CorpIM) has replaced an old one (AcmeIM)

* It is worth to say that only "device A", which has the ADMINISTRATOR capability, can perform this action.

Some steps have been omited, for more information please check the identity contracts in this repository.

### Adding/removing capabilities to an existing device

Adding/removing capabilities to an exiting device follows the exact process as adding a new device. Please check the "Adding another device" section.

### Check user device permissions level

[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZVgtPj5JZGVudGl0eU1hbmFnZXI6IEpob25Qcm94eUFkZHJlc3MsPGJyLz5Kb2huRGV2aWNlWCw8YnIvPmNhcGFiaWxpdHlcblx0YWx0IGhhc0NhcFxuXHRJZGVudGl0eU1hbmFnZXItLT4-Sm9obkRldmljZVg6IHRydWVcblx0ZWxzZSBub3QgYXV0aG9yaXplZFxuXHRJZGVudGl0eU1hbmFnZXItLT4-Sm9obkRldmljZVg6IGZhbHNlXG5cdGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZVgtPj5JZGVudGl0eU1hbmFnZXI6IEpob25Qcm94eUFkZHJlc3MsPGJyLz5Kb2huRGV2aWNlWCw8YnIvPmNhcGFiaWxpdHlcblx0YWx0IGhhc0NhcFxuXHRJZGVudGl0eU1hbmFnZXItLT4-Sm9obkRldmljZVg6IHRydWVcblx0ZWxzZSBub3QgYXV0aG9yaXplZFxuXHRJZGVudGl0eU1hbmFnZXItLT4-Sm9obkRldmljZVg6IGZhbHNlXG5cdGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)

## Forwarding though the IdentityManager

Through the IdentityManager contract(AcmeIdentityManager) you are also able to forward transactions to any other contract, for that when you invoke AcmeIdentityManager for forward transactions it will make some verifications and then pass this message to your proxy contract (JhonProxy) which will make some verifications before reaching the desired contract.
To clarify this, lets see a diagram to illustrate this flow:

[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZVgtPj5BY21lSWRlbnRpdHlNYW5hZ2VyOiBhcmd1bWVudHMsIG1ldGhvZCw8YnIvPiBhZGRyZXNzQ29udHJhY3RYXG5cdFxuXHRBY21lSWRlbnRpdHlNYW5hZ2VyLT4-QWNtZUlkZW50aXR5TWFuYWdlcjogY2hlY2sgZm9yd2FkIGNhcGFiaWxpdHlcblx0YWx0IGhhcyBKb2huRGV2aWNlWCBcImZvcndhcmRcIiBjYXBhYmlsaXR5P1x0XG5cdEFjbWVJZGVudGl0eU1hbmFnZXItPj5Kb2huUHJveHk6IGFyZ3VtZW50cyxhZGRyZXNzXG5cblx0Sm9oblByb3h5LT4-Sm9oblByb3h5OiBjaGVjayBBY21lSWRlbnRpdHlNYW5hZ2VyPGJyLz4gaXMgbXkgb3duZXJcblx0YWx0IGlzIEFjbWVJZGVudGl0eU1hbmFnZXIgbXkgb3duZXI_XHRcblx0Sm9oblByb3h5LT4-Q29udHJhY3RYOiBhcmd1bWVudHMsIG1ldGhvZFxuXHRDb250cmFjdFgtPj5Db250cmFjdFg6IGRvIHNvbWUgc3R1ZmZcblx0Q29udHJhY3RYLS0-PkpvaG5EZXZpY2VYOiBBTEwgRE9ORSA6KVxuXHRlbHNlIG5vdEF1dGhvcml6ZWRcblx0Sm9oblByb3h5LS0-PkpvaG5EZXZpY2VYOiBUaHJvd1xuXHRlbmRcblx0ZWxzZSBub3QgYXV0aG9yaXplZFxuXHRBY21lSWRlbnRpdHlNYW5hZ2VyLS0-PkpvaG5EZXZpY2VYOiB0aHJvd1xuXHRlbmQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdGF1dG9udW1iZXJcblx0Sm9obkRldmljZVgtPj5BY21lSWRlbnRpdHlNYW5hZ2VyOiBhcmd1bWVudHMsIG1ldGhvZCw8YnIvPiBhZGRyZXNzQ29udHJhY3RYXG5cdFxuXHRBY21lSWRlbnRpdHlNYW5hZ2VyLT4-QWNtZUlkZW50aXR5TWFuYWdlcjogY2hlY2sgZm9yd2FkIGNhcGFiaWxpdHlcblx0YWx0IGhhcyBKb2huRGV2aWNlWCBcImZvcndhcmRcIiBjYXBhYmlsaXR5P1x0XG5cdEFjbWVJZGVudGl0eU1hbmFnZXItPj5Kb2huUHJveHk6IGFyZ3VtZW50cyxhZGRyZXNzXG5cblx0Sm9oblByb3h5LT4-Sm9oblByb3h5OiBjaGVjayBBY21lSWRlbnRpdHlNYW5hZ2VyPGJyLz4gaXMgbXkgb3duZXJcblx0YWx0IGlzIEFjbWVJZGVudGl0eU1hbmFnZXIgbXkgb3duZXI_XHRcblx0Sm9oblByb3h5LT4-Q29udHJhY3RYOiBhcmd1bWVudHMsIG1ldGhvZFxuXHRDb250cmFjdFgtPj5Db250cmFjdFg6IGRvIHNvbWUgc3R1ZmZcblx0Q29udHJhY3RYLS0-PkpvaG5EZXZpY2VYOiBBTEwgRE9ORSA6KVxuXHRlbHNlIG5vdEF1dGhvcml6ZWRcblx0Sm9oblByb3h5LS0-PkpvaG5EZXZpY2VYOiBUaHJvd1xuXHRlbmRcblx0ZWxzZSBub3QgYXV0aG9yaXplZFxuXHRBY21lSWRlbnRpdHlNYW5hZ2VyLS0-PkpvaG5EZXZpY2VYOiB0aHJvd1xuXHRlbmQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ)
